import httpx
import time
import logging

# پیکربندی Logging
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')


def send_request():
    """ارسال درخواست با استفاده از httpx."""
    url = 'https://github.com/moosavimaleki/books/pull/4/comment?sticky=true'
    headers = {
        'accept': 'application/json',
        'accept-language': 'en-US,en;q=0.9,fa;q=0.8',
        'cache-control': 'no-cache',
        'origin': 'https://github.com',
        'pragma': 'no-cache',
        'priority': 'u=1, i',
        'referer': 'https://github.com/moosavimaleki/books/pull/4',
        'sec-ch-ua': '"Google Chrome";v="131", "Chromium";v="131", "Not_A Brand";v="24"',
        'sec-ch-ua-mobile': '?0',
        'sec-ch-ua-platform': '"Linux"',
        'sec-fetch-dest': 'empty',
        'sec-fetch-mode': 'cors',
        'sec-fetch-site': 'same-origin',
        'user-agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36',
        'x-requested-with': 'XMLHttpRequest',
        'x-timeline-last-modified': '2025-03-13T21:56:00.000000000+03:30',
    }

    data = {
        'authenticity_token': 'bXl23FdPY1CzXp07dz15PcPzJCtYFbm2repMgJUAdL9J-9DvnvpBolNAN4rFL6_83of0T_NjpP-UGWk_Sy6H6A',
        'required_field_bdbb': '',
        'timestamp': '1741891330456',
        'timestamp_secret': 'b1cafa9a3d1804078891eb5d6d8e134edec8e88e0bee47e971b08cb86d1b7502',
        'issue': '4',
        'saved_reply_id': '',
        'comment[body]': """میخواهم تمامی فایل های درون designing-data-intensive-applications/en را به فارسی ترجمه کنم و در پوشه designing-data-intensive-applications/fa بریزم

دقت داشته باش که 1342 فایل درون پوشه designing-data-intensive-applications/en

شما یک سیستم هوش مصنوعی پیشرفته در زمینه ویراستاری زبان فارسی هستید. هدف شما، ارائه متونی رسا، زیبا و مطابق با استانداردهای زبان فارسی است.

میخواهم تمامی فایل های درون {designing-data-intensive-applications/en} را به فارسی ترجمه کنم و در پوشه {designing-data-intensive-applications/fa} بریزم

نحوه اجرا:

دقت داشته باش که {1342} فایل درون پوشه {designing-data-intensive-applications/en} است
فایل ها *.md هستند
تمام انها را به ترتیب از part قبلی که ترجمه کردی تا part{md_files_count} ترجمه کن
در هنگام ترجمه فرمت markdown را حفظ کن و همه موارد را انتقال بده
این کار رو بدون نوشتن اسکریپت انجام بده و فقط md تولید کن
سوالی نپرس و فقط md تولید کن
برای خواندن فایل ها از cat استفاده کن

نحو ترجمه:

شما یک سیستم هوش مصنوعی پیشرفته در زمینه ویراستاری زبان فارسی هستید. هدف شما، ارائه متونی رسا، زیبا و مطابق با استانداردهای زبان فارسی است. با توجه به آموزش «ویراستاری و مهارت‌های درست‌نویسی» و تخصص خود در مهندسی هوش مصنوعی، وظایف خود را با درک عمیق مفاهیم زیر انجام دهید:

«شما یک مترجم و ویراستار حرفه‌ای هستید که در حوزه مهندسی نرم‌افزار و فناوری اطلاعات تخصص دارید. لطفاً متن زیر را از زبان انگلیسی به زبان فارسی ویراستاری و ترجمه کنید.

در انجام این کار، موارد زیر را رعایت کنید:

اطمینان حاصل کنید که تمام مفاهیم فنی و تخصصی مهندسی نرم‌افزار را به‌طور صحیح و کامل منتقل می‌کنید.
در صورت وجود اصطلاحات یا عبارات تخصصی، معادل‌های رایج و صحیح در فارسی را به کار ببرید یا در صورت نیاز، توضیح مختصری ارائه دهید.
هر انچه نیاز از به عنوان لغت در زبان اصلی در پاورقی ذکر شود در پرانتز بیاورید.
اگر متن اصلی سبک رسمی یا نیمه‌رسمی دارد، در ترجمه نیز همین سطح رسمیت را حفظ کنید.
در صورت وجود کد، مثال یا شبه‌کد (pseudo-code)، آن را به همان شکل نگه دارید .
مراقب باشید هیچ بخشی از متن را حذف نکنید یا به متن اصلی اطلاعات اضافی اضافه نکنید؛ تنها در صورت نیاز (مثلاً برای معادل‌های تخصصی نامأنوس) توضیح خیلی مختصر در پرانتز یا پانویس بیاورید.
در صورت وجود واژگان فارسی مصوب یا جاافتاده در حوزه مهندسی نرم‌افزار (مانند «سامانه» به‌جای «سیستم»، «پودمان» به‌جای «ماژول» و...) از آن‌ها استفاده کنید؛ اما اگر کاربرد واژه انگلیسی رواج بیشتری دارد، به شکل ترجمه‌شده یا با توضیح کوتاه به کار ببرید.
در تمام موارد برای لغات تخصصی ، معادل انگلیسی آن را در پارانتز جلوی آن قرار بده (مانند پاورقی در کتاب ها)

به عنوان یک ویراستار، نه تنها غلط‌یاب، بلکه تسهیل‌گر انتقال معنا، ایجادکننده تعامل، احیاگر متن و پاسدار زبان فارسی باشید.

از رویکردی فعال و خلاقانه برای بهبود کیفیت زبانی متن استفاده کنید و از تغییرات صرفاً مکانیکی پرهیز کنید.

ویراستاری به معنای پیراستن متن از خطاها، ابهامات و نارسايي‌ها، و رساندن آن به بالاترین سطح کیفیت زبانی است و تو باید این کار را انجام بدی.

ویراستاری شامل مراحل مختلفی است، که باید تمام آن ها را در متنی که برایم تولید می کنی رعایت کنی.
۱-بررسی املایی و نشانه‌گذاری و ویراستاری صوری
۲-اصلاح ساختار جملات و عبارات
۳-ویرایش محتوایی (اطمینان از صحت اطلاعات و انسجام منطقی متن)
۴-ویرایش زبانی (بهبود لحن و سبک نگارش)

ویراستاری صوری (ظاهری):

نشانه‌گذاری: بررسی و اصلاح نشانه‌گذاری با هدف بهبود خوانایی، وضوح معنا و انتقال لحن.

انواع نشانه‌ها: نقطه (.), کاما (,)، نقطه‌کاما (;)، دونقطه (:), سه‌نقطه (...), علامت پرسش (؟), علامت عاطفی (!), گیومه («») پرانتز (()), کروشه ([]).

نکات کلیدی:

کاما: جداسازی اجزای جمله، جداسازی فهرست‌ها، نشان دادن مکث کوتاه

نقطه: پایان جمله، نشان دادن اختصار

نقطه‌کاما: ایجاد تعادل بین نقطه و کاما، ایجاد ارتباط بین جملات مرتبط

سه‌نقطه: حذف بخشی از متن، نشان دادن مکث طولانی، ایجاد تعلیق

گیومه: نقل قول مستقیم، تأکید بر یک واژه، نام‌گذاری

پرانتز: توضیحات اضافی، ارجاعات درون‌متنی، معادل‌های واژه‌ها

کروشه: افزودن توضیحات توسط ویراستار، نشان دادن حذف بخشی از متن اصلی

ویراستاری زبانی:

انتخاب واژگان: انتخاب واژگان مناسب، گویا و رسا برای انتقال دقیق منظور نویسنده و از معادل‌های فارسی رایج و معیار استفاده کنید.

مثال: به جای «ایفاد» از «انجام دادن» استفاده کنید، و به جای اصطلاحات عامیانه مانند "اِکی" از معادل های رسمی استفاده کنید.

گرته‌برداری: اجتناب از گرته‌برداری‌های نامناسب و نامأنوس که باعث کاهش کیفیت زبانی متن می‌شوند.

راهنما: از واژه‌های دخیل مناسب یا گرته‌برداری‌های ترکیبی (با رعایت اصول زبان فارسی) استفاده کنید.

مثال: به جای «تحت‌اللفظی» از «لفظ به لفظ» استفاده کنید.

کژتابی (ابهام): رفع ابهام از جملات و عبارات با هدف جلوگیری از برداشت‌های نادرست.

علل کژتابی: نامشخص بودن مرجع ضمیر، ساختارهای پیچیده، فشرده‌گویی بیش از حد، حذف اجزای ضروری جمله.

مثال: "من مثل شما بلد نیستم" (آیا نویسنده "مهارت" شخص مقابل را ندارد یا "اعتقاد" او را؟)

حشونویسی و درازنویسی: حذف تکرارهای غیرضروری و کوتاه کردن جملات برای افزایش تمرکز و خوانایی متن.

راهنما: از تکرار بی‌مورد واژه‌ها و عبارات و طولانی کردن بی‌دلیل جملات خودداری کنید.

مثال: "این موضوع بسیار بسیار مهم است" (بهتر است: "این موضوع بسیار مهم است").

کاربرد نادرست فعل: استفاده از فعل‌های نامناسب، ناهمخوان با نهاد، یا به شکل غیرفصیح.

راهنما: به هماهنگی فعل و نهاد، وجه فعل، و انتخاب فعل مناسب با توجه به زمان و معنای جمله دقت کنید.

مثال: "رزمندگان به دشمن یورش برد" (بهتر است: "رزمندگان به دشمن یورش بردند").

کاربرد نادرست حرف: استفاده از حروف اضافه و ربط به شکل نادرست یا غیرفصیح.

راهنما: به کاربرد صحیح حروف و نقش آنها در جمله توجه کنید.

مثال: "او علاقه‌مند به ادبیات است" (بهتر است: "او علاقه‌مند ادبیات است").

خطاهای آوایی: اجتناب از صداهای ناخوشایند در متن به دلیل تکرار، تتابع اضافات، و تنافر حروف و کلمات.

راهنما: به آهنگ و روانی زبان در هنگام خواندن متن توجه کنید.

مثال: "کتابی خوب و خوب و خوب" (بهتر است: "کتابی بسیار خوب").

معیارنویسی انجام بده! یعنی استفاده از زبانی که در عین زیبایی و رسایی، منطبق بر قواعد زبان فارسی و قابل فهم برای عموم باشد.

خروجی:

ویژگی‌های متن خروجی باید بر اساس قواعد زیر در زبان معیار باشد:

۱-منطبق بودن بر دستور زبان فارسی
۲-انتقال بیشترین مفاهیم با کمترین واژه‌ها
۳-استفاده از واژه‌های رایج و قابل فهم
۴-نزدیک بودن به زبان گفتار (در عین پرهیز از عامیانه‌نویسی)
۵-شفافیت، رسایی و منطقی بودن
۶-پرهیز از بار احساسی و جانبداری

سایر ویژگی های مهم متن خروجی:
متن نهایی باید رسا، زیبا، روان و مطابق با استانداردهای زبان فارسی باشد.
متن نهایی باید به صورت markdown باشد و متن ورودی هم markdown است و المان های درون مارک‌دان نباید از بین بروند
متن نهایی باید فارسی و با زبان معیار باشد.
متن نهایی باید ویرستاری ادبی شده باشد.
در جاهایی که لازم است برای خوانایی بهتر از کسره استفاده کن اما زیاده روی استفاده از کسره منجر به تتابع اضافات و پیچیدگی میشه و فقط زمانی که مجبور هستی از کسره استفاده کن
متن نهایی نباید گرته برداری از انگلیسی داشته باشد
متن نهایی نباید درازه گویی داشته باشد.
متن نهایی **باید** ویراستاری صوری شده باشد. (در درخواست اول اشتباهی گفته بودم: نباید، اما باید ویراستاری صوری شده باشد)
متن نهایی نباید کژتابی داشته باشد.
متن نهایی نباید تتابع افعال ، جدا افتادگی اجزای فعل ، تتابع اضافات و... داشته باشد.
جملات متن نهایی باید خوانا و بدون پیچیدگی باشد.

شروع کار:
ترجمه را آغاز کن و
توقف نکن و تا فایل 1342 ادامه بده""",
        'path': '',
        'line': '',
        'start_line': '',
        'preview_side': '',
        'preview_start_side': '',
        'start_commit_oid': '',
        'end_commit_oid': '',
        'base_commit_oid': '',
        'comment_id': ''
    }

    # تبدیل دیکشنری 'data' به فرمت multipart/form-data
    files = {k: (None, v) for k, v in data.items()}  # httpx requires (filename, value) tuples

    cookies = {
        '_octo': 'GH1.1.1668695001.1735100685',
        '_device_id': '1aea08ddf4f711e3f62280b086ac59ac',
        'saved_user_sessions': '1008267%3AxwIXvhN1HNTNENGXNsLiT-M-onh2tZ6HFcmFRw9W1r5XNsLu',
        'user_session': 'xwIXvhN1HNTNENGXNsLiT-M-onh2tZ6HFcmFRw9W1r5XNsLu',
        '__Host-user_session_same_site': 'xwIXvhN1HNTNENGXNsLiT-M-onh2tZ6HFcmFRw9W1r5XNsLu',
        'logged_in': 'yes',
        'dotcom_user': 'moosavimaleki',
        'color_mode': '{"color_mode":"auto","light_theme":{"name":"light","color_mode":"light"},"dark_theme":{"name":"dark","color_mode":"dark"}}',
        'cpu_bucket': 'xlg',
        'preferred_color_mode': 'dark',
        'tz': 'Asia%2FTehran',
        '_gh_sess': 'cn8NPuFjg0pLBsCUQIIRzfz9UckzqUFbdAgYRid0%2B7XRLCuAWyV1%2B2YP39%2FDSX3hn9nEnnJKYank6tZQbiLgyQeGXJTUQFQkSWruT%2BdT2cDKTcro4pUu2ShM1t21Bh8YQ2Vq2V2F3%2FReLEV07e2AyBPLZBKtv0Y0zanhOB1usIwzaXPgYhcQAYDcg4yW9Cua6%2FN08tgBVYtLPYqjpzMdFUbfGcwEKGzmKvMcnA%2BDgIKKSFHZr3Fs%2Bisef6jW%2BTOjnksEH1R6R94YgHVYaNIHFihAKqPXc4UAUWFg4rvB0Ccm0TppgEr9PJ2AWAMkB2LY65U44cOmPzWelwYrK3fT0V8fz%2B8GIn%2B8wre8AzMG1S6rbvfpy%2FgQVVmL6LUwq5jyfMP1vLUc%2FNBh7Yj4L3gkmmsRdVtAaHFcw4wTsVxO1qMbbTAk7E92QWh46fB0Z4pmSpok2TZP5L7qap86%2FhJNT3ticwluEbYajo96Xg%3D%3D--2OxndF2OEFEzd7dz--eJhQ%2B3th0wtQcCeleSCdKw%3D%3D'
    }

    try:
        with httpx.Client(cookies=cookies, headers=headers) as client:
            response = client.post(url, files=files)
            response.raise_for_status()  # Raise HTTPError for bad responses (4xx or 5xx)
            logging.info("Request sent successfully.")
            # logging.info(f"Response: {response.text}") # لاگ کردن پاسخ اگر نیاز باشد
    except httpx.HTTPStatusError as e:
        logging.error(f"HTTP error: {e}")
        logging.error(f"Response content: {e.response.text}")
    except httpx.RequestError as e:
        logging.error(f"Request error: {e}")
    except Exception as e:
        logging.error(f"An error occurred: {e}")


if __name__ == "__main__":
    while True:
        send_request()
        logging.info("Sleeping for 16 minutes...")
        for i in range(16):
            logging.info(f"Minute {i + 1} of 16...")
            time.sleep(60)  # Sleep for 1 minute