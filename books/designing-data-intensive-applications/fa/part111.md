توانایی استفاده از کد جاوااسکریپت در میان یک پرس‌وجو یک ویژگی عالی برای پرس‌وجوهای پیشرفته است، اما این محدود به MapReduce نیست—برخی از پایگاه‌های داده SQL نیز می‌توانند با توابع جاوااسکریپت گسترش یابند [[34](ch02.html#Kerstiens2013ur)].

یک مشکل کاربردپذیری با MapReduce این است که شما باید دو تابع جاوااسکریپت که به دقت هماهنگ شده‌اند را بنویسید، که اغلب سخت‌تر از نوشتن یک پرس‌وجوی واحد است. علاوه بر این، یک زبان پرس‌وجوی اعلانی فرصت‌های بیشتری برای بهینه‌ساز پرس‌وجو جهت بهبود عملکرد یک پرس‌وجو ارائه می‌دهد. به این دلایل، MongoDB 2.2 پشتیبانی از یک زبان پرس‌وجوی اعلانی به نام خط لوله تجمیع (aggregation pipeline) را اضافه کرد [[9](ch02.html#MongoDB2013)]. در این زبان، همان پرس‌وجوی شمارش کوسه‌ها به این شکل است:

```
db.observations.aggregate([
    { $match: { family: "Sharks" } },
    { $group: {
        _id: {
            year:  { $year:  "$observationTimestamp" },
            month: { $month: "$observationTimestamp" }
        },
        totalAnimals: { $sum: "$numAnimals" }
    } }
]);
```

زبان خط لوله تجمیع از نظر بیان‌پذیری مشابه زیرمجموعه‌ای از SQL است، اما به جای نحو شبیه به جمله انگلیسی SQL، از نحو مبتنی بر JSON استفاده می‌کند؛ تفاوت شاید مسئله سلیقه باشد. نتیجه اخلاقی داستان این است که یک سیستم NoSQL ممکن است به طور تصادفی خود را 