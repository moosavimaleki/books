![ddia 0403](assets/ddia_0403.png)

###### شکل 4-3. رکورد نمونه کدگذاری شده با استفاده از CompactProtocol تریفت.

در نهایت، پروتکل بافرز (که فقط یک قالب کدگذاری باینری دارد) همان داده‌ها را همانطور که در [شکل 4-4](#fig_encoding_protobuf) نشان داده شده است، کدگذاری می‌کند. بسته‌بندی بیت را کمی متفاوت انجام می‌دهد، اما در غیر این صورت بسیار شبیه به CompactProtocol تریفت است. پروتکل بافرز همان رکورد را در 33 بایت جا می‌دهد.

![ddia 0404](assets/ddia_0404.png)

###### شکل 4-4. رکورد نمونه کدگذاری شده با استفاده از پروتکل بافرز.

یک نکته قابل توجه: در طرح‌واره‌هایی که قبلاً نشان داده شد، هر فیلد یا به عنوان required (الزامی) یا optional (اختیاری) علامت‌گذاری شده بود، اما این تفاوتی در نحوه کدگذاری فیلد ایجاد نمی‌کند (هیچ چیز در داده‌های باینری نشان نمی‌دهد که آیا یک فیلد الزامی بوده است). تفاوت به سادگی این است که required یک بررسی زمان اجرا را فعال می‌کند که اگر فیلد تنظیم نشده باشد، با شکست مواجه می‌شود، که می‌تواند برای کشف اشکالات مفید باشد.

### برچسب‌های فیلد و تکامل طرح‌واره

قبلاً گفتیم که طرح‌واره‌ها ناگزیر باید در طول زمان تغییر کنند. ما این را تکامل طرح‌واره می‌نامیم. تریفت و پروتکل بافرز چگونه تغییرات طرح‌واره را در عین حفظ سازگاری پسرو و پیشرو مدیریت می‌کنند؟